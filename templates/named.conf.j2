// PowerDNS Bind backend configuration
// This file defines the zones that PowerDNS will serve using the bind backend
// 
// IMPORTANT: This uses PowerDNS bind backend syntax, not standard BIND9 syntax
// Security is handled at the PowerDNS level in pdns.conf, not here

// Include TSIG key for zone transfers
{% set env = 'staging' if DEPLOY_ENV == 'staging' else 'production' %}
include "/etc/powerdns/tsig-keys/zone-transfer.conf";

options {
    directory "/etc/powerdns/zones";
};

{% set zones = powerdns[env].zones %}

// Configure zones dynamically based on environment
{% for zone in zones %}
zone "{{ zone }}" {
    type master;
    file "/etc/powerdns/zones/{{ zone }}.zone";
    {% if pdns_role|default('slave') == 'master' %}
    allow-transfer { key zone-transfer; };
    {% endif %}
};

{% endfor %}