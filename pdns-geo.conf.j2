# PowerDNS Configuration with Geo-routing and Lua Records
# This configuration enables both the pipe backend and Lua records for geo-routing

# Primary backend - Bind backend for all zones, plus GeoIP for Lua Records
launch=bind,geoip

# Bind backend configuration for all zones
bind-config=/etc/powerdns/named.conf
bind-check-interval=60

# Enable Lua records for geo-routing
enable-lua-records=yes
lua-health-checks-interval=2

# GeoIP configuration for Lua Records (MMDB format)
geoip-database-files=mmdb:/usr/share/GeoIP/GeoLite2-City.mmdb;mode=mmap;language=en

# EDNS Client Subnet for better geo-location accuracy
edns-subnet-processing=yes

# Performance and caching settings
cache-ttl=60
negquery-cache-ttl=60
query-cache-ttl=20
max-cache-entries=1000000

# Logging configuration
loglevel=4
log-dns-queries=yes
log-dns-details=yes

# Security settings
webserver=no
api=no

# DNSSEC settings - prevent DNSSEC key responses to avoid REFUSED responses
direct-dnskey=no

# Network settings
local-address=0.0.0.0
local-port=53
socket-dir=/var/run/pdns

# Thread settings
distributor-threads=3
receiver-threads=2

# Query settings
max-tcp-connections=20
max-queue-length=5000

# Zone transfer settings
allow-axfr-ips=127.0.0.1
primary=no
secondary=no
